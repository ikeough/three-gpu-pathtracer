var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},t={},a=e.parcelRequire5b70;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in t){var a=t[e];delete t[e];var o={id:e,exports:{}};return n[e]=o,a.call(o.exports,o,o.exports),o.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,n){t[e]=n},e.parcelRequire5b70=a);var o=a("ilwiq"),r=a("RPVlj"),i=a("7lx9d"),s=a("5Rd1x"),l=a("4CEV9"),d=a("cVdfP"),m=a("891vQ"),c=a("kp7Te"),u=a("jiuw3");let p,h,g,w,b,y,f,v,C,M,x,I,B,E,F;const R={hideInfo:!1,acesToneMapping:!0,stableNoise:!1,tiles:2,bounces:15,multipleImportanceSampling:!0,resolutionScale:1/window.devicePixelRatio,environmentBlur:0,environmentIntensity:1,environmentRotation:0,backgroundBlur:.1,filterGlossyFactor:.5};function S(){const e=window.innerWidth,n=window.innerHeight,t=R.resolutionScale,a=window.devicePixelRatio;w.setSize(e*t*a,n*t*a),w.reset(),p.setSize(e,n),p.setPixelRatio(window.devicePixelRatio*t);const o=e/n;f.aspect=o,f.updateProjectionMatrix()}function T(){const e=M.generate(C,R.environmentBlur);w.material.envMapInfo.updateFrom(e),x.environment=e,w.reset()}function G(){requestAnimationFrame(G),F.style.visibility=R.hideInfo?"hidden":"visible";const e=v[R.material],[n,t]=y;!function(e,n){n.color.set(16777215),n.transmission=0,n.attenuationDistance=1/0,n.attenuationColor.set(16777215),n.specularColor.set(16777215),n.metalness=0,n.roughness=1,n.ior=1.5,n.thickness=1,e.specularColor&&n.specularColor.setRGB(...e.specularColor),"metalness"in e&&(n.metalness=e.metalness),"roughness"in e&&(n.roughness=e.roughness),"ior"in e&&(n.ior=e.ior),"transmission"in e&&(n.transmission=e.transmission),n.transmission?(e.color&&n.attenuationColor.setRGB(...e.color),n.attenuationDistance=200/e.density):e.color&&n.color.setRGB(...e.color);const t=e.name.replace(/\s+/g,"-").replace(/[()]+/g,"");E.src=`https://physicallybased.info/reference/render/${t}-cycles.webp`,B.innerText=`${e.description}`,B.style.display=e.description?"inline-block":"none"}(e,n),t.color.setRGB(.5,.5,.5).convertSRGBToLinear(),t.roughness=1,t.metalness=0,w.material.materials.updateFrom(g.materials,g.textures),w.material.filterGlossyFactor=R.filterGlossyFactor,w.material.environmentIntensity=R.environmentIntensity,w.material.backgroundBlur=R.backgroundBlur,w.material.bounces=R.bounces,w.material.physicalCamera.updateFrom(f),f.updateMatrixWorld(),R.backgroundAlpha<1?x.background=null:x.background=x.environment,w.update(),w.samples<1&&p.render(x,f),p.autoClear=!1,b.material.map=w.target.texture,b.render(p),p.autoClear=!0,I.innerText=`Samples: ${Math.floor(w.samples)}`}window.innerWidth/window.innerHeight<.65&&(R.bounces=Math.max(R.bounces,6),R.resolutionScale*=.5,R.tiles=2,R.multipleImportanceSampling=!1,R.environmentBlur=.35,hideInfo=!0),async function(){p=new o.WebGLRenderer({antialias:!0}),p.toneMapping=o.ACESFilmicToneMapping,p.outputEncoding=o.sRGBEncoding,p.setClearColor(0,0),document.body.appendChild(p.domElement);const e=window.innerWidth/window.innerHeight;f=new o.PerspectiveCamera(75,e,.025,500),f.position.set(-4,2,3),w=new l.PathTracingRenderer(p),w.camera=f,w.material=new l.PhysicalPathTracingMaterial,w.material.setDefine("FEATURE_MIS",Number(R.multipleImportanceSampling)),w.tiles.set(R.tiles,R.tiles),b=new r.FullScreenQuad(new o.MeshBasicMaterial({map:w.target.texture,blending:o.CustomBlending,premultipliedAlpha:p.getContextAttributes().premultipliedAlpha})),h=new s.OrbitControls(f,p.domElement),h.addEventListener("change",(()=>{w.reset()})),x=new o.Scene,I=document.getElementById("samples"),B=document.getElementById("materialInfo"),E=document.getElementById("materialImage"),F=document.getElementById("info"),M=new l.BlurredEnvMapGenerator(p);const n=(new m.RGBELoader).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/autoshop_01_1k.hdr").then((e=>{C=e,T()})),t=new d.PathTracingSceneWorker,a=(new i.GLTFLoader).setMeshoptDecoder(c.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/material-balls/material_ball_v2.glb").then((e=>{const n=new o.Group;e.scene.scale.setScalar(.01),e.scene.updateMatrixWorld(),n.add(e.scene);const a=new o.Box3;a.setFromObject(e.scene);const r=new o.Mesh(new o.CylinderGeometry(3,3,.05,200),new o.MeshPhysicalMaterial({color:16777215,roughness:0,metalness:.25}));r.geometry=r.geometry.toNonIndexed(),r.geometry.clearGroups(),r.position.y=a.min.y-.03,n.add(r);const i=new o.MeshPhysicalMaterial,s=new o.MeshPhysicalMaterial;return e.scene.traverse((e=>{e.geometry&&e.geometry.computeVertexNormals(),"Sphere_1"===e.name?e.material=s:e.material=i,"subsphere_1"===e.name&&(e.material=s)})),y=[i,s,r.material],t.generate(n)})).then((e=>{g=e,x.add(e.scene);const{bvh:n,textures:a,materials:o}=e,r=n.geometry,i=w.material;i.bvh.updateFrom(n),i.attributesArray.updateFrom(r.attributes.normal,r.attributes.tangent,r.attributes.uv,r.attributes.color),i.materialIndexAttribute.updateFrom(r.attributes.materialIndex),i.textures.setTextures(p,2048,2048,a),i.materials.updateFrom(o,a),t.dispose()})),P=fetch("https://api.physicallybased.info/materials").then((e=>e.json())).then((e=>{v={},e.forEach((e=>{v[e.name]=e}))}));await Promise.all([P,a,n]),document.getElementById("loading").remove(),S(),window.addEventListener("resize",S);const k=new u.GUI,A=Object.keys(v);R.material=A[0],k.add(R,"material",A).onChange((()=>{w.reset()})),k.add(R,"hideInfo");const N=k.addFolder("Path Tracing");N.add(R,"acesToneMapping").onChange((e=>{p.toneMapping=e?o.ACESFilmicToneMapping:o.NoToneMapping,b.material.needsUpdate=!0})),N.add(R,"stableNoise").onChange((e=>{w.stableNoise=e})),N.add(R,"multipleImportanceSampling").onChange((e=>{w.material.setDefine("FEATURE_MIS",Number(e)),w.reset()})),N.add(R,"tiles",1,4,1).onChange((e=>{w.tiles.set(e,e)})),N.add(R,"filterGlossyFactor",0,1).onChange((()=>{w.reset()})),N.add(R,"bounces",1,30,1).onChange((()=>{w.reset()})),N.add(R,"resolutionScale",.1,1).onChange((()=>{S()}));const _=k.addFolder("Environment");_.add(R,"environmentIntensity",0,10).onChange((()=>{w.reset()})),_.add(R,"environmentRotation",0,2*Math.PI).onChange((e=>{w.material.environmentRotation.setFromMatrix4((new o.Matrix4).makeRotationY(e)),w.reset()})),_.add(R,"environmentBlur",0,1).onChange((()=>{T()})),_.add(R,"backgroundBlur",0,1).onChange((()=>{w.reset()})),G()}();
//# sourceMappingURL=materialDatabase.9c81f2f8.js.map
