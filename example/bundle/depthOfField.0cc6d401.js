var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},a=e.parcelRequire5b70;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in n){var a=n[e];delete n[e];var r={id:e,exports:{}};return t[e]=r,a.call(r.exports,r,r.exports),r.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},e.parcelRequire5b70=a);var r=a("ilwiq"),o=a("RPVlj"),i=a("7lx9d"),s=a("5Rd1x"),d=a("4CEV9"),l=a("cVdfP"),c=a("891vQ"),u=a("kp7Te"),m=a("jiuw3");let p,h,w,g,f,b,y,v;const x=new r.Vector2,F=new r.Vector3,M={environmentIntensity:.5,environmentRotation:0,bounces:3,samplesPerFrame:1,resolutionScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,autoFocus:!0};function C(e){x.set(e.clientX,e.clientY)}function S(e){if(Math.abs(x.x-e.clientX)+Math.abs(x.y-e.clientY)<2&&w){const t=w.bvh,n=new r.Raycaster;n.setFromCamera({x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1},f);const a=t.raycastFirst(n.ray);a&&(F.copy(a.point),f.focusDistance=a.distance-f.near,g.reset())}}function E(){const e=window.innerWidth,t=window.innerHeight,n=M.resolutionScale,a=window.devicePixelRatio;g.setSize(e*n*a,t*n*a),g.reset(),p.setSize(e,t),p.setPixelRatio(window.devicePixelRatio*n),f.aspect=e/t,f.updateProjectionMatrix()}function R(){g.reset()}function P(){requestAnimationFrame(P),M.autoFocus&&(f.focusDistance=f.position.distanceTo(F)-f.near),g.material.materials.updateFrom(w.materials,w.textures),g.material.filterGlossyFactor=M.filterGlossyFactor,g.material.environmentIntensity=M.environmentIntensity,g.material.bounces=M.bounces,g.material.physicalCamera.updateFrom(f),f.updateMatrixWorld();for(let e=0,t=M.samplesPerFrame;e<t;e++)g.update();g.samples<1&&p.render(y,f),p.autoClear=!1,b.render(p),p.autoClear=!0,v.innerText=`Samples: ${Math.floor(g.samples)}`}window.innerWidth/window.innerHeight<.65&&(M.bounces=Math.max(M.bounces,6),M.resolutionScale*=.5,M.tiles=2),async function(){p=new r.WebGLRenderer({antialias:!0}),p.toneMapping=r.ACESFilmicToneMapping,p.outputEncoding=r.sRGBEncoding,document.body.appendChild(p.domElement),f=new d.PhysicalCamera(60,window.innerWidth/window.innerHeight,.025,500),f.position.set(-.262,.5276,-1.1606),f.apertureBlades=6,f.fStop=.6,f.focusDistance=1.1878,F.set(-.5253353217832674,.3031596413506029,.000777794185259223),y=new r.Scene;const e=new d.GradientEquirectTexture;e.topColor.set(3739424).convertSRGBToLinear(),e.bottomColor.set(1383199).convertSRGBToLinear(),e.update(),g=new d.PathTracingRenderer(p),g.camera=f,g.material=new d.PhysicalPathTracingMaterial,g.tiles.set(M.tiles,M.tiles),g.material.setDefine("FEATURE_MIS",0),g.material.backgroundMap=e,b=new o.FullScreenQuad(new r.MeshBasicMaterial({map:g.target.texture,blending:r.CustomBlending})),h=new s.OrbitControls(f,p.domElement),h.target.set(-.182,.147,.06),h.update(),h.addEventListener("change",(()=>{g.reset()})),v=document.getElementById("samples");const t=(new c.RGBELoader).loadAsync("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr").then((e=>{const t=new d.BlurredEnvMapGenerator(p),n=t.generate(e,.35);g.material.envMapInfo.updateFrom(n),t.dispose(),e.dispose(),y.environment=n})),n=new l.PathTracingSceneWorker,a=(new i.GLTFLoader).setMeshoptDecoder(u.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/sd-macross-city-standoff-diorama/scene.glb").then((e=>{const t=new r.Group,a=new r.SphereGeometry(1,10,10),o=new r.MeshStandardMaterial({emissiveIntensity:10,emissive:16777215});for(let e=0;e<300;e++){const e=new r.Mesh(a,o);e.scale.setScalar(.075*Math.random()+.03),e.position.randomDirection().multiplyScalar(30+15*Math.random()),t.add(e)}return e.scene.scale.setScalar(.5),e.scene.updateMatrixWorld(),t.add(e.scene),e.scene.traverse((e=>{e.material&&(e.material.roughness=.05,e.material.metalness=.05)})),n.generate(t)})).then((e=>{w=e,y.add(e.scene);const{bvh:t,textures:a,materials:r}=e,o=t.geometry,i=g.material;i.bvh.updateFrom(t),i.attributesArray.updateFrom(o.attributes.normal,o.attributes.tangent,o.attributes.uv,o.attributes.color),i.materialIndexAttribute.updateFrom(o.attributes.materialIndex),i.textures.setTextures(p,2048,2048,a),i.materials.updateFrom(r,a),n.dispose()}));await Promise.all([a,t]),document.getElementById("loading").remove(),E(),window.addEventListener("resize",E),p.domElement.addEventListener("mouseup",S),p.domElement.addEventListener("mousedown",C);const x=new m.GUI,T=x.addFolder("Path Tracing");T.add(M,"tiles",1,4,1).onChange((e=>{g.tiles.set(e,e)})),T.add(M,"samplesPerFrame",1,10,1),T.add(M,"bounces",1,30,1).onChange((()=>{g.reset()})),T.add(M,"resolutionScale",.1,1).onChange((()=>{E()}));const G=x.addFolder("Camera");G.add(f,"focusDistance",1,100).onChange(R).listen(),G.add(f,"apertureBlades",0,10,1).onChange((function(e){f.apertureBlades=0===e?0:Math.max(e,3),this.updateDisplay(),R()})),G.add(f,"apertureRotation",0,12.5).onChange(R),G.add(f,"anamorphicRatio",.1,10).onChange(R),G.add(f,"bokehSize",0,100).onChange(R).listen(),G.add(f,"fStop",.02,20).onChange(R).listen(),G.add(f,"fov",25,100).onChange((()=>{f.updateProjectionMatrix(),R()})).listen(),G.add(M,"autoFocus"),P()}();
//# sourceMappingURL=depthOfField.0cc6d401.js.map
